<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Harvest Horizons Dashboard</title>
  <link rel="icon" href="favicon.ico" />
  <link rel="stylesheet" href="style.css?v=20260101" />
  <!-- Leaflet CSS with fallback chain -->
  <link id="leafletCss" rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        onerror="this.onerror=null;this.href='https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css'"/>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <img src="assets/interact.gif" alt="INTERACT" class="brandMark" onerror="this.style.display='none'"/>
      <div>
        <div class="brandTitle">Harvest Horizons</div>
        <div class="brandSub">Campaign dashboard</div>
      </div>
    </div>

    <div class="controls">
      <div class="control">
        <label for="campaignSelect">Campaign</label>
        <select id="campaignSelect"></select>
      </div>

      <div class="control">
        <label>Date range</label>
        <div class="rangeRow">
          <input id="dateFrom" type="date" />
          <span class="muted">to</span>
          <input id="dateTo" type="date" />
          <button class="btn" id="applyBtn">Apply</button>
          <button class="btn btnGhost" id="resetBtn">Reset</button>
          <button class="btn btnGhost" id="exportBtn">Export CSV</button>
        </div>
        <div id="rangeHint" class="smallMuted"></div>
      </div>
    </div>
  </header>

  <nav class="tabBar" role="tablist" aria-label="Dashboard tabs">
    <a class="tabBtn tabBtn--active" data-tab="summary" role="tab" aria-selected="true" href="#summary">Summary</a>
    <a class="tabBtn" data-tab="map" role="tab" aria-selected="false" href="#map">Map</a>
    <a class="tabBtn" data-tab="sessions" role="tab" aria-selected="false" href="#sessions">Sessions</a>
    <a class="tabBtn" data-tab="media" role="tab" aria-selected="false" href="#media">Media</a>
    <a class="tabBtn" data-tab="feedback" role="tab" aria-selected="false" href="#feedback">Feedback</a>
  </nav>

  <main id="app" class="">
    <section class="grid2" data-tab="summary" id="summary">
      <section class="card">
        <h2>Campaign insights at a glance</h2>
        <div class="kpis">
          <div class="kpi"><div class="kpiLabel">Sessions</div><div class="kpiVal" id="kpiSessions">—</div></div>
          <div class="kpi"><div class="kpiLabel">Farmers reached</div><div class="kpiVal" id="kpiFarmers">—</div></div>
          <div class="kpi"><div class="kpiLabel">Acres engaged</div><div class="kpiVal" id="kpiAcres">—</div></div>
          <div class="kpi"><div class="kpiLabel">Avg score</div><div class="kpiVal" id="kpiScore">—</div></div>
        </div>
        <div class="divider"></div>
        <div class="tableWrap">
          <table class="sessionTable" id="topSessionsTable">
            <thead>
              <tr>
                <th>Date</th><th>Sheet</th><th>District</th><th>Village</th><th>Farmers</th><th>Acres</th><th>Score</th><th>Open</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <section class="card">
        <h2>Status</h2>
        <div id="statusBox" class="status">Loading…</div>
        <div class="divider"></div>
        <div class="smallMuted">
          Tip: Use the Sessions tab to open each sheet (D1S1, D1S2…) and verify per-session summaries.
        </div>
      </section>
    </section>

    <section class="card mapCard hidden" data-tab="map" id="map">
      <div class="mapHeader">
        <div>
          <h2>Map view</h2>
          <div class="muted">Markers reflect the currently filtered date range.</div>
        </div>
        <div id="mapStatus" class="badge">Loading…</div>
      </div>
      <div id="leafletMap" class="map">Loading map…</div>
      <div class="divider"></div>
      <div id="mapFallback" class="smallMuted hidden">
        Map library could not be loaded. Use the Sessions table and “Open in Google Maps” links in details.
      </div>
    </section>

    <section class="card hidden" data-tab="sessions" id="sessions">
      <div class="row">
        <h2>Sessions</h2>
        <div class="muted">Click a row to preview; use buttons to open sheet/details.</div>
      </div>
      <div class="tableWrap">
        <table class="sessionTable" id="sessionsTable">
          <thead>
            <tr>
              <th>Date</th><th>Sheet</th><th>District</th><th>Village</th><th>Farmers</th><th>Acres</th><th>Score</th><th>Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <section class="card hidden" data-tab="media" id="media">
      <div class="row">
        <h2>Media</h2>
        <div class="muted">Thumbnails are pulled from assets/gallery. Missing files will fall back to placeholders.</div>
      </div>
      <div id="mediaGrid" class="mediaGrid"></div>
    </section>

    <section class="card hidden" data-tab="feedback" id="feedback">
      <h2>Feedback</h2>
      <div class="muted">Optional notes for your team (stored locally in your browser).</div>
      <div class="divider"></div>
      <div class="grid2">
        <div class="card">
          <label class="muted" for="fbText">Notes</label>
          <textarea id="fbText" rows="8" placeholder="Write notes here…"></textarea>
          <div class="drawerActions">
            <button class="btn" id="fbSave">Save</button>
            <button class="btn btnGhost" id="fbClear">Clear</button>
          </div>
          <div id="fbMsg" class="smallMuted"></div>
        </div>
        <div class="card">
          <h3>Quick links</h3>
          <ul class="muted">
            <li><a href="healthcheck.html" class="link">Healthcheck</a></li>
            <li><a href="sheets.html" class="link">Sheets browser</a></li>
          </ul>
        </div>
      </div>
    </section>
  </main>

  <!-- Session drawer overlay -->
  <div class="drawerOverlay hidden" id="drawerOverlay" aria-hidden="true"></div>
  <aside class="drawer hidden" id="sessionDrawer" aria-hidden="true" aria-label="Session details">
    <div class="drawerTop">
      <div>
        <div class="drawerTitle" id="drawerTitle">Session</div>
        <div class="drawerSub" id="drawerSub">—</div>
      </div>
      <button class="iconBtn" id="drawerClose" aria-label="Close">✕</button>
    </div>

    <div class="drawerBody">
      <div class="kpis kpis--compact">
        <div class="kpi"><div class="kpiLabel">Farmers</div><div class="kpiVal" id="dFarmers">—</div></div>
        <div class="kpi"><div class="kpiLabel">Acres</div><div class="kpiVal" id="dAcres">—</div></div>
        <div class="kpi"><div class="kpiLabel">Score</div><div class="kpiVal" id="dScore">—</div></div>
      </div>

      <div class="divider"></div>
      <div id="dMeta" class="muted"></div>

      <div class="divider"></div>
      <div class="drawerActions">
        <a class="btn" id="dOpenSheet" href="#">Open sheet</a>
        <a class="btn btnGhost" id="dOpenDetails" href="#">Open details</a>
        <a class="btn btnGhost" id="dOpenMaps" href="#" target="_blank" rel="noopener">Open in Google Maps</a>
      </div>

      <div class="divider"></div>
      <h3>Sheet summary</h3>
      <div id="dSheetSummary" class="muted">Loading…</div>

      <div class="divider"></div>
      <h3>Media</h3>
      <div id="dMedia" class="mediaRow"></div>
    </div>
  </aside>

  <!-- Lightbox for media -->
  <div id="lightbox" class="lightbox" role="dialog" aria-modal="true" aria-label="Media viewer">
    <div class="lightboxInner">
      <div class="lightboxTop">
        <div id="lbTitle" class="muted">Media</div>
        <button class="iconBtn" id="lbClose" aria-label="Close">✕</button>
      </div>
      <div class="lightboxBody" id="lbBody"></div>
    </div>
  </div>

  <!-- Leaflet JS is loaded lazily by dashboard.js when the Map tab is opened. -->

  <script src="dashboard.js?v=20260101"></script>
</body>
</html>
