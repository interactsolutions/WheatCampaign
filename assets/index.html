<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <meta name="theme-color" content="#0b1220"/>
  <title>INTERACT â€¢ Campaign Dashboard</title>
  <link rel="stylesheet" href="style.css"/>
  <!-- Leaflet (map) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="anonymous" onerror="this.onerror=null;this.href='https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css';">
</head>
<body>
  <div class="bg">
    <video id="bgVideo" class="bgVideo" autoplay muted loop playsinline preload="metadata"></video>
    <div class="bgShade"></div>
  </div>

  <header class="header">
    <div class="headerInner">
      <div class="brand">
        <div class="brandMark" aria-label="Brand header">
  <img class="brandLogo" src="assets/bayer.svg" alt="Bayer" />
  <div class="brandText">
    <div class="brandName">Wheat Campaign Dashboard</div>
    <div class="brandSub">Campaign insights for brand management Â· INTERACT</div>
  </div>
</div>
        <div class="brandSub">Insights, coverage and field media â€” built for teams, partners and the community.</div>
      </div>
      <div class="headerActions">
        <a class="chip link" href="./details.html?campaign=buctril-super-2025">Detailed view</a>
        <a class="chip link" href="#feedback">Send feedback</a>
      </div>
    </div>

    <div class="heroWrap">
      <div class="heroPlayer" id="heroPlayer" aria-label="Header video playlist">
        <video id="heroVideo" muted autoplay playsinline loop preload="metadata"></video>
        <img id="heroPoster" alt="" />
        <div class="heroOverlay"></div>
        <div class="heroCaption">
          <div class="heroTitle" id="heroTitle">Campaign highlights</div>
          <div class="heroSub" id="heroSub">If video does not auto-play on iPhone, tap once to start.</div>
        </div>
        <div class="heroControls">
          <button class="iconBtn" id="heroPrev" title="Previous">â€¹</button>
          <button class="iconBtn" id="heroNext" title="Next">â€º</button>
          <button class="iconBtn" id="heroMute" title="Mute/Unmute">ðŸ”‡</button>
        </div>
      </div>
      <div class="heroThumbs" id="heroThumbs" aria-label="Header video thumbnails"></div>
    </div>
  </header>

  <main class="main">
    <section class="controls card">
      <div class="controlsRow">
        <div class="control">
          <label>Campaign</label>
          <select id="campaignSelect"></select>
        </div>
        <div class="control">
          <label>District</label>
          <select id="districtSelect"></select>
        </div>
        <div class="control">
          <label>Search</label>
          <input id="searchInput" placeholder="Host, dealer, village, spotâ€¦"/>
        </div>
        <div class="control">
          <label>Date range</label>
          <div class="dateRange">
            <input id="fromDate" type="date"/>
            <span class="to">to</span>
            <input id="toDate" type="date"/>
          </div>
        </div>
        <div class="control actions">
          <label class="srOnly">Actions</label>
          <button class="btn primary" id="applyBtn">Apply</button>
          <button class="btn" id="resetBtn">Reset</button>
          <button class="btn" id="exportBtn">Export</button>
        </div>
      </div>

      <div class="statusRow">
        <div class="chips">
          <span class="chip" id="selectionChip">All districts â€¢ All dates</span>
          <span class="chip muted" id="statusChip">Status: initializingâ€¦</span>
          <div id="fatalHint" class="fatalHint" style="display:none"></div>
        </div>
        <div class="miniKPIs">
          <div class="miniKpi"><div class="miniLabel">Sessions</div><div class="miniVal" id="kSessions">â€”</div></div>
          <div class="miniKpi"><div class="miniLabel">Farmers</div><div class="miniVal" id="kFarmers">â€”</div></div>
          <div class="miniKpi"><div class="miniLabel">Acres</div><div class="miniVal" id="kAcres">â€”</div></div>
          <div class="miniKpi"><div class="miniLabel">Avg Score</div><div class="miniVal" id="kScore">â€”</div></div>
        </div>
      </div>
    </section>

      <div class="tabs" role="tablist" aria-label="Dashboard sections">
        <a class="tabBtn tabBtn--active" data-tab="summary" role="tab" aria-selected="true" href="#summary">Summary</a>
        <a class="tabBtn" data-tab="map" role="tab" aria-selected="false" href="#map">Map</a>
        <a class="tabBtn" data-tab="sessions" role="tab" aria-selected="false" href="#sessions">Sessions</a>
        <a class="tabBtn" data-tab="media" role="tab" aria-selected="false" href="#media">Media</a>
        <a class="tabBtn" data-tab="feedback" role="tab" aria-selected="false" href="#feedback">Feedback</a>
      </div>


    <section class="grid2" data-tab="summary" id="summary">
      <section class="card" id="insights">
        <h2>Campaign insights at a glance</h2>
        <p class="muted">Clear, comparable metrics for stakeholder decisions: awareness, intent, understanding, and coverage.</p>
        <div class="donutGrid">
          <div class="donutCard">
            <div class="donutTitle">Adoption intent</div>
            <div class="donutWrap" id="donutIntent"></div>
            <div class="donutMeta muted" id="metaIntent">â€”</div>
          </div>
          <div class="donutCard">
            <div class="donutTitle">Brand awareness</div>
            <div class="donutWrap" id="donutAwareness"></div>
            <div class="donutMeta muted" id="metaAwareness">â€”</div>
          </div>
          <div class="donutCard">
            <div class="donutTitle">Message understanding</div>
            <div class="donutWrap" id="donutUnderstanding"></div>
            <div class="donutMeta muted" id="metaUnderstanding">â€”</div>
          </div>
          <div class="donutCard">
            <div class="donutTitle">Coverage by acres</div>
            <div class="donutWrap" id="donutCoverage"></div>
            <div class="donutMeta muted" id="metaCoverage">â€”</div>
          </div>
        </div>
        <div class="insightsRow">
          <div class="insight">
            <div class="insightLabel">Top reason to use</div>
            <div class="insightVal" id="topUse">â€”</div>
          </div>
          <div class="insight">
            <div class="insightLabel">Top reason not to use</div>
            <div class="insightVal" id="topNotUse">â€”</div>
          </div>
          <div class="insight">
            <div class="insightLabel">Competitors mentioned</div>
            <div class="insightVal" id="topCompetitors">â€”</div>
          </div>
        </div>
      </section>
    </section>

    <section class="card mapCard hidden" data-tab="map" id="map">
        <div class="mapHeader">
          <div>
            <h2>Map view</h2>
            <p class="muted">Spots are shown by default. Tap a spot to open the session profile with people, performance and media.</p>
          </div>
          <div class="mapBtns">
            <button class="btn" id="fitBtn">Fit</button>
            <button class="btn" id="mapResetBtn">Reset</button>
          </div>
        </div>
        <div class="mapWrap">
          <div id="leafletMap" class="map">Loading mapâ€¦</div>
          <div id="mapFallback" class="mapFallback hidden">
            <div class="warn">Map unavailable on this device/network.</div>
            <div class="muted">You can still browse sessions and open locations in Google Maps from each session profile.</div>
          </div>
        </div>

        <aside class="drawer" id="sessionDrawer" aria-label="Session profile">
          <div class="drawerTop">
            <div>
              <div class="drawerTitle" id="dTitle">Session â€”</div>
              <div class="drawerSub muted" id="dSub">â€”</div>
            </div>
            <button class="iconBtn" id="drawerClose" title="Close">
              <span aria-hidden="true">âœ•</span>
            </button>
          </div>

          <div class="drawerGrid">
            <div class="kv"><div class="k">Host</div><div class="v" id="dHost">â€”</div></div>
            <div class="kv"><div class="k">Sales rep</div><div class="v" id="dRep">â€”</div></div>
            <div class="kv"><div class="k">Dealer</div><div class="v" id="dDealer">â€”</div></div>
            <div class="kv"><div class="k">Farmers</div><div class="v" id="dFarmers">â€”</div></div>
            <div class="kv"><div class="k">Wheat acres</div><div class="v" id="dAcres">â€”</div></div>
            <div class="kv"><div class="k">Definite</div><div class="v" id="dDefinite">â€”</div></div>
            <div class="kv"><div class="k">Score</div><div class="v" id="dScore">â€”</div></div>
            <div class="kv"><div class="k">Top reason to use</div><div class="v" id="dTopUse">â€”</div></div>
            <div class="kv"><div class="k">Top reason not to use</div><div class="v" id="dTopNotUse">â€”</div></div>
          </div>

          <div class="drawerActions">
            <button class="btn" id="openMapsBtn">Open in Maps</button>
            <button class="btn" id="shareSessionBtn">Share session</button>
          </div>

          <h3 class="drawerSectionTitle">Session media</h3>
          <div id="drawerMedia" class="drawerMedia"></div>
        </aside>
      </section>
    </section>

    <section class="card hidden" data-tab="sessions" id="sessions">
      <div class="sectionHeader">
        <div>
          <h2>Sessions</h2>
          <p class="muted">Filter by district and date to view exact sessions and their outcomes. Tap a row to open the session profile.</p>
        </div>
        <div class="pager">
          <button class="btn" id="prevBtn">Prev</button>
          <span class="muted" id="pageInfo">Page 1 / 1</span>
          <button class="btn" id="nextBtn">Next</button>
        </div>
      </div>

      <div class="tableWrap">
        <table class="table" id="sessionsTable">
          <thead>
            <tr>
              <th>Date</th><th>District</th><th>Spot</th><th class="num">Farmers</th><th class="num">Acres</th><th class="num">Definite %</th><th class="num">Awareness %</th><th class="num">Score</th>
            </tr>
          </thead>
          <tbody id="sessionsTbody">
            <tr><td colspan="8" class="muted">Loadingâ€¦</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <section class="card hidden" data-tab="media" id="media">
      <div class="sectionHeader">
        <div>
          <h2>Media wall</h2>
          <p class="muted">Animated cards combine each sessionâ€™s photo and video. Only items from <code>assets/gallery/</code> are shown.</p>
        </div>
        <div class="mediaCounters">
          <div class="chip" id="mSessions">â€” Sessions</div>
          <div class="chip" id="mImages">â€” Images</div>
          <div class="chip" id="mVideos">â€” Videos</div>
        </div>
      </div>

      <div class="mediaWall" id="mediaWall">
        <div class="muted">Loadingâ€¦</div>
      </div>
    </section>
    </section>

    <section class="card hidden" data-tab="feedback" id="feedback">
      <h2>Share feedback</h2>
      <p class="muted">Help us improve field activations. Provide your email or phone and send feedback to INTERACT.</p>

      <div class="feedbackGrid">
        <div class="control">
          <label>Name (optional)</label>
          <input id="fbName" placeholder="Your name"/>
        </div>
        <div class="control">
          <label>Email</label>
          <input id="fbEmail" placeholder="name@example.com"/>
        </div>
        <div class="control">
          <label>Phone</label>
          <input id="fbPhone" placeholder="+92XXXXXXXXXX"/>
        </div>
        <div class="control full">
          <label>Feedback</label>
          <textarea id="fbText" rows="4" placeholder="What worked well? What should be improved?"></textarea>
        </div>
      </div>

      <div class="feedbackActions">
        <div class="muted">Send to <a class="link" href="mailto:interact@paksaf.com">interact@paksaf.com</a> â€¢ Contact <a class="link" href="tel:+92355223233">+92355223233</a> â€¢ WhatsApp <a class="link" href="https://wa.me/923303570463" target="_blank" rel="noopener">+923303570463</a></div>
        <div class="btnRow">
          <button class="btn" id="emailFeedbackBtn">Email feedback</button>
          <button class="btn whatsapp" id="waFeedbackBtn">WhatsApp feedback</button>
        </div>
        <div class="muted small" id="fbValidate"></div>
        <div class="muted small" id="fbHint">We will only use your contact to follow up on the feedback if needed.</div>
      </div>
    </section>

    <footer class="footer">
      <div class="footerBrands" id="footerBrands" aria-label="Brand assets"></div>
      <div class="muted">Powered by <strong>INTERACT</strong> â€” multi-campaign field intelligence dashboards.</div>
    </footer>

  </main>

  <div class="lightbox hidden" id="lightbox" aria-hidden="true">
    <div class="lightboxInner">
      <button class="iconBtn lightboxClose" id="lightboxClose" title="Close">âœ•</button>
      <div class="lightboxBody" id="lightboxBody"></div>
      <div class="lightboxActions">
        <button class="btn" id="shareMediaBtn">Share</button>
        <button class="btn" id="copyLinkBtn">Copy link</button>
      </div>
    </div>
  </div>

  <script>
  // Leaflet loader with CDN fallback (some networks block unpkg)
  window.__loadLeafletFallback = (function(){
    var tried = 0;
    var fallbacks = [
      'https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js',
      'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js'
    ];
    return function(){
      if (window.L) return;
      var u = fallbacks[tried++];
      if (!u) return;
      var s = document.createElement('script');
      s.src = u;
      s.crossOrigin = 'anonymous';
      s.onerror = window.__loadLeafletFallback;
      document.head.appendChild(s);
    };
  })();
</script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin="anonymous"
        onerror="window.__loadLeafletFallback && window.__loadLeafletFallback()"></script>
  <script src="dashboard.js?v=20251230" defer></script>
<script>
/* Tab fallback: keeps navigation working even if dashboard.js fails to load */
(function(){
  function $$ (sel, root){ return (root||document).querySelector(sel); }
  function $$$ (sel, root){ return Array.prototype.slice.call((root||document).querySelectorAll(sel)); }
  function setActive(tab){
    tab = (tab||'summary').replace(/^#/, '');
    var btns = $$$('.tabBtn[data-tab]');
    var secs = $$$('section[data-tab]');
    btns.forEach(function(b){
      var on = (b.getAttribute('data-tab')===tab);
      b.classList.toggle('tabBtn--active', on);
      b.setAttribute('aria-selected', on ? 'true' : 'false');
    });
    secs.forEach(function(s){
      var on = (s.getAttribute('data-tab')===tab);
      s.classList.toggle('hidden', !on);
    });
  }
  document.addEventListener('click', function(e){
    var a = e.target && e.target.closest ? e.target.closest('.tabBtn[data-tab]') : null;
    if(!a) return;
    // allow hash update, but ensure UI updates immediately
    var tab = a.getAttribute('data-tab');
    setActive(tab);
  }, true);

  window.addEventListener('hashchange', function(){
    setActive((location.hash||'#summary').slice(1));
  });

  document.addEventListener('DOMContentLoaded', function(){
    // initialize from hash
    setActive((location.hash||'#summary').slice(1));
  });
})();
</script>
</body>
</html>
