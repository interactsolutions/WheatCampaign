<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>INTERACT | Field Intelligence Dashboard</title>
  <meta name="description" content="INTERACT multi-campaign field intelligence dashboard. Bayer wheat activations: coverage, intent, understanding, media proof, and actionable insights." />
  <link rel="preconnect" href="https://unpkg.com" />
  <link rel="preconnect" href="https://cdn.jsdelivr.net" />
  <link rel="stylesheet" href="style.css" />
  <!-- Leaflet (Map) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- Chart.js (Graphs) -->
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script defer src="dashboard.js"></script>
</head>
<body>
  <div class="video-bg-container" aria-hidden="true">
    <video id="bgVideo" muted playsinline loop preload="metadata"></video>
    <div class="video-bg-overlay"></div>
  </div>

  <header class="main-header">
    <div class="topbar">
      <div class="brand">
        <div class="brand-mark" aria-hidden="true">I</div>
        <div>
          <div class="brand-name">INTERACT</div>
          <div class="brand-tag">Field Intelligence Dashboard</div>
        </div>
      </div>

      <nav class="topnav">
        <a class="navlink" href="healthcheck.html" id="healthcheckLink">Healthcheck</a>
        <button class="btn btn-outline" id="exportBtn" type="button">Export (CSV)</button>
      </nav>
    </div>

    <div class="header-strip" id="headerStrip" aria-label="Header brand videos">
      <!-- Populated by JS (sequence is enforced) -->
    </div>

    <div class="hero">
      <h1 id="campaignTitle">Loading campaign…</h1>
      <p id="campaignDesc">Preparing dashboard…</p>

      <div class="hero-badges">
        <span class="badge" id="badgeSessions">Sessions: —</span>
        <span class="badge" id="badgeFarmers">Farmers: —</span>
        <span class="badge" id="badgeAcres">Acres: —</span>
        <span class="badge badge-soft" id="badgeScore">Avg Session Score: —</span>
      </div>
    </div>
  </header>

  <main class="container">
    <div id="errorBanner" class="error-banner hidden" role="alert">
      <div class="error-title">Data loading issue</div>
      <div class="error-body" id="errorText">—</div>
      <div class="error-actions">
        <a class="btn btn-secondary" href="healthcheck.html">Open Healthcheck</a>
        <button class="btn btn-outline" id="dismissErrorBtn" type="button">Dismiss</button>
      </div>
    </div>

    <section class="controls-card">
      <div class="controls-grid">
        <div class="control">
          <label for="campaignSelect">Campaign</label>
          <select id="campaignSelect" class="field"></select>
        </div>

        <div class="control">
          <label for="districtSelect">District</label>
          <select id="districtSelect" class="field">
            <option value="__all__">All</option>
          </select>
        </div>

        <div class="control">
          <label for="searchInput">Search</label>
          <input id="searchInput" class="field" type="search" placeholder="Host / Dealer / Location / Session ID" />
        </div>

        <div class="control">
          <label>Date range</label>
          <div class="date-range">
            <input id="dateFrom" class="field" type="date" />
            <span class="to">to</span>
            <input id="dateTo" class="field" type="date" />
          </div>
        </div>
      </div>

      <div class="controls-actions">
        <button class="btn btn-primary" id="applyBtn" type="button">Apply</button>
        <button class="btn btn-outline" id="resetBtn" type="button">Reset</button>
      </div>

      <div class="controls-hint">
        KPIs, charts, map, sessions and gallery update together based on your filters.
      </div>
    </section>

    <section class="kpi-grid" aria-label="Key metrics">
      <div class="kpi">
        <div class="kpi-label">Sessions</div>
        <div class="kpi-value" id="kpiSessions">—</div>
        <div class="kpi-sub" id="kpiSessionsSub">Totals recomputed from session rows</div>
      </div>
      <div class="kpi">
        <div class="kpi-label">Farmers reached</div>
        <div class="kpi-value" id="kpiFarmers">—</div>
        <div class="kpi-sub" id="kpiWheatFarmers">Wheat farmers: —</div>
      </div>
      <div class="kpi">
        <div class="kpi-label">Acres covered</div>
        <div class="kpi-value" id="kpiAcres">—</div>
        <div class="kpi-sub" id="kpiEstAcres">Est. Buctril acres: —</div>
      </div>
      <div class="kpi">
        <div class="kpi-label">Key influencers</div>
        <div class="kpi-value" id="kpiInfluencers">—</div>
        <div class="kpi-sub">Highlighted names in field notes</div>
      </div>
    </section>

    <section class="value-card">
      <h2>What a Bayer marketing team gets from this dashboard</h2>
      <div class="value-grid">
        <div class="value-item">
          <div class="value-title">Demand signal</div>
          <div class="value-text">Definite intent, maybe intent and non-interest—weighted by audience size—by district and by session.</div>
        </div>
        <div class="value-item">
          <div class="value-title">Message effectiveness</div>
          <div class="value-text">Understanding scores (Yield loss, Golden period, Broadleaf control, Buctril+Atlantis benefit, Safety/PPE) with an overall Session Score.</div>
        </div>
        <div class="value-item">
          <div class="value-title">Drivers & barriers</div>
          <div class="value-text">Top reasons to use (e.g., Trust in Bayer) and blockers (e.g., Price too high) based on field responses.</div>
        </div>
        <div class="value-item">
          <div class="value-title">Proof of execution</div>
          <div class="value-text">Session media (photos/videos) linked to district and session, usable for internal reporting and social proof.</div>
        </div>
      </div>
    </section>

    <section class="charts">
      <div class="section-head">
        <h2>Performance analytics</h2>
        <p class="muted">Charts reflect your current selection (All / District / Search / Date range).</p>
      </div>

      <div class="charts-grid">
        <div class="chart-card">
          <h3>Adoption funnel</h3>
          <canvas id="chartFunnel" height="220"></canvas>
          <div class="chart-fallback hidden" id="chartFunnelFallback"></div>
        </div>

        <div class="chart-card">
          <h3>District coverage</h3>
          <canvas id="chartDistrict" height="220"></canvas>
          <div class="chart-fallback hidden" id="chartDistrictFallback"></div>
        </div>

        <div class="chart-card">
          <h3>Understanding (avg)</h3>
          <canvas id="chartUnderstanding" height="220"></canvas>
          <div class="chart-fallback hidden" id="chartUnderstandingFallback"></div>
        </div>

        <div class="chart-card">
          <h3>Top reasons to use</h3>
          <canvas id="chartReasons" height="220"></canvas>
          <div class="chart-fallback hidden" id="chartReasonsFallback"></div>
        </div>
      </div>
    </section>

    <section class="map-gallery">
      <div class="map-card">
        <div class="section-head">
          <h2>Coverage map</h2>
          <div class="muted" id="mapMeta">Markers: —</div>
        </div>
        <div id="map" class="map"></div>
        <div class="map-fallback hidden" id="mapFallback">
          Map library did not load (Leaflet). You can still browse sessions and media below.
        </div>
      </div>

      <div class="gallery-card">
        <div class="section-head">
          <h2>Media gallery</h2>
          <div class="muted" id="galleryMeta">—</div>
        </div>

        <div class="gallery-filters">
          <button class="chip active" data-media-filter="all" type="button">All</button>
          <button class="chip" data-media-filter="photos" type="button">Photos</button>
          <button class="chip" data-media-filter="videos" type="button">Videos</button>
        </div>

        <div id="galleryGrid" class="gallery-grid">
          <div class="gallery-placeholder">Loading media…</div>
        </div>
      </div>
    </section>

    <section class="sessions">
      <div class="section-head">
        <h2>Sessions</h2>
        <div class="muted" id="sessionsMeta">—</div>
      </div>

      <div class="sessions-table-wrap" id="sessionsTableWrap">
        <table class="sessions-table" id="sessionsTable">
          <thead>
            <tr>
              <th>SN</th>
              <th>Date</th>
              <th>District</th>
              <th>Location</th>
              <th>Farmers</th>
              <th>Acres</th>
              <th>Definite %</th>
              <th>Awareness %</th>
              <th>Score</th>
            </tr>
          </thead>
          <tbody id="sessionsTbody">
            <tr><td colspan="9" class="muted">Loading sessions…</td></tr>
          </tbody>
        </table>
      </div>

      <div class="sessions-cards" id="sessionsCards" aria-label="Sessions (mobile)">
        <!-- JS -->
      </div>
    </section>

    <section class="insights">
      <div class="section-head">
        <h2>Auto-insights</h2>
        <p class="muted">Computed from current selection to help action planning.</p>
      </div>
      <div id="insightsBox" class="insights-box">Computing insights…</div>
    </section>

    <footer class="footer">
      Built by <strong>INTERACT</strong> — multi-campaign field intelligence. Data and KPIs are recomputed from session rows (summary row ignored).
    </footer>
  </main>

  <!-- Session drawer -->
  <aside class="drawer" id="drawer" aria-hidden="true">
    <div class="drawer-head">
      <div>
        <div class="drawer-title" id="drawerTitle">Session</div>
        <div class="drawer-sub" id="drawerSub">—</div>
      </div>
      <button class="icon-btn" id="drawerCloseBtn" aria-label="Close session details" type="button">✕</button>
    </div>

    <div class="drawer-body" id="drawerBody">
      <!-- JS -->
    </div>
  </aside>

  <div class="backdrop hidden" id="backdrop"></div>
</body>
</html>
