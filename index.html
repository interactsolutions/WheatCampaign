<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Harvest Horizons — Buctril Activations Report</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" crossorigin></script>

    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js" crossorigin></script>

    <style>
        :root{
            --bg:#0b1220;
            --panel:#0f1a2e;
            --panel2:#111f39;
            --text:#e7edf7;
            --muted:#9fb0ca;
            --border:rgba(255,255,255,.10);
            --shadow: 0 10px 30px rgba(0,0,0,.35);
            --radius:16px;
            --accent:#7dd3fc;
            --accent2:#86efac;
            --warn:#fbbf24;
            --bad:#fb7185;
        }
        *{ box-sizing:border-box; }
        html,body{ height:100%; }
        body{
            margin:0;
            font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji","Segoe UI Emoji";
            color:var(--text);
            background:
                radial-gradient(1100px 600px at 15% 10%, rgba(125,211,252,.18), transparent 55%),
                radial-gradient(900px 600px at 85% 25%, rgba(134,239,172,.14), transparent 55%),
                linear-gradient(180deg, #070c15, var(--bg));
            overflow-x:hidden;
        }
        a{ color:inherit; }
        .muted{ color:var(--muted); }
        .wrap{ display: flex; flex-direction: column; min-height: 100vh; }
        .layout{ display: grid; grid-template-columns: 280px 1fr; gap: 40px; max-width: 1400px; margin: 40px auto; padding: 0 20px; flex-grow: 1; }
        
        /* Thematic Sections */
        .theme-section { 
            position: relative; 
            min-height: 800px; 
            padding: 40px; 
            background: linear-gradient(to bottom, var(--panel), var(--panel2)); 
            border-radius: var(--radius); 
            margin-bottom: 40px; 
            overflow: hidden; /* To contain orbiting elements */
        }
        .central-media { 
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            width: 60%; 
            height: 60%; 
            border-radius: var(--radius); 
            overflow: hidden; 
            box-shadow: var(--shadow); 
            z-index: 10;
        }
        .central-media video, .central-media img { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
            /* Media files will fail silently if not found */
        }
        
        /* Data Planets (Orbiting Elements) */
        .data-planet { 
            position: absolute; 
            width: 120px; 
            height: 120px; 
            background: rgba(134,239,172,.8); 
            border-radius: 50%; 
            display: flex; 
            flex-direction: column;
            align-items: center; 
            justify-content: center; 
            text-align: center; 
            font-weight: bold; 
            box-shadow: 0 0 20px rgba(134,239,172,.5);
            z-index: 5;
            top: 50%; /* Center start point vertically */
            left: 50%; /* Center start point horizontally */
        }
        .data-planet span { font-size: 1.5em; display: block; }
        
        @keyframes orbit { 
            0% { transform: rotate(0deg) translateX(300px) rotate(0deg); } 
            100% { transform: rotate(360deg) translateX(300px) rotate(-360deg); } 
        }
        
        .planet1 { animation: orbit 25s linear infinite; }
        .planet2 { animation: orbit 35s linear infinite; }
        .planet3 { animation: orbit 45s linear infinite; }
        
        /* Filters Sidebar */
        .sidebar { position: sticky; top: 20px; background: var(--panel); padding: 20px; border-radius: var(--radius); }
        .sidebar h3 { color: var(--accent2); margin-top: 0; }
        
        /* Map (FIXED PLACEMENT) */
        #map { 
            height: 400px; 
            border-radius: var(--radius); 
            margin-top: 40px; /* Space it out from the central media */
            z-index: 10;
            position: relative;
        }
        
        /* Table styles */
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 8px 12px; text-align: left; border-bottom: 1px solid var(--border); }
        th { background: rgba(255,255,255,.05); }
        td.right { text-align: right; }
        
        /* Loading Overlay and Error Modal (Minimal) */
        #loadingOverlay, #errorContainer { 
            position: fixed; top: 0; left: 0; right: 0; bottom: 0; 
            background: var(--bg); color: var(--text); 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            z-index: 9999; transition: opacity 0.3s;
        }
        
    </style>
</head>
<body>
<div id="loadingOverlay">
    <h2 id="loadingStatus">Loading Dashboard...</h2>
</div>

<div id="errorContainer" style="display:none"></div>

<div class="wrap" id="appShell">
    <header class="hero" style="text-align: center; padding: 40px 0; background-color: var(--panel);">
        <h1>Harvest Horizons Dashboard</h1>
        <p class="muted">Buctril Activations Field Report</p>
    </header>
    
    <div class="layout">
        <aside class="sidebar">
            <h3>Filters & Snapshot</h3>
            <div>
                <label class="muted" for="filter-city">City:</label>
                <select id="filter-city" style="width: 100%; padding: 5px; margin-bottom: 10px;"></select>
            </div>
            <div>
                <label class="muted" for="filter-spot">Spot:</label>
                <select id="filter-spot" style="width: 100%; padding: 5px; margin-bottom: 10px;"></select>
            </div>
            <div>
                <label class="muted">Date Range:</label>
                <div id="filter-date" style="font-size: 1.2em; color: var(--accent2);">—</div>
            </div>
        </aside>

        <main>
            <section class="theme-section" id="seed-awareness">
                <h2>Seed of Awareness</h2>
                <div class="central-media" id="awareness-media"></div>
                <div class="data-planet planet1">Farmers: <span id="awareness-farmers">—</span></div>
                <div class="data-planet planet2">Acres: <span id="awareness-acres">—</span></div>
                <div class="data-planet planet3">Awareness %: <span id="awareness-pct">—</span></div>
            </section>

            <section class="theme-section" id="growth-journey">
                <h2>Growth Journey</h2>
                <div class="central-media" id="journey-media"></div>
                
                <div class="data-planet planet1">Sessions: <span id="journey-sessions">—</span></div>
                <div class="data-planet planet2">Definite %: <span id="journey-def">—</span></div>
                
                <div id="map"></div>
                
                <div style="position: absolute; bottom: 40px; right: 40px; background: var(--panel); padding: 10px; border-radius: 8px;">
                    Selected: 
                    <strong id="mapSelFarmers">—</strong> Farmers, 
                    <strong id="mapSelAcres">—</strong> Acres
                </div>
            </section>

            <section class="theme-section" id="harvest-impact">
                <h2>Harvest Impact</h2>
                <div class="central-media" id="impact-media"></div>
                
                <div class="data-planet planet1">Clarity %: <span id="impact-clarity">—</span></div>
                
                <div class="data-planet planet2" style="width: 150px; height: 150px;">
                    <canvas id="chartIntent" width="150" height="150"></canvas>
                </div>
            </section>

            <section class="theme-section" id="future-fields">
                <h2>Future Fields</h2>
                <div class="central-media" id="future-media"></div>
                
                <div class="data-planet planet1">Recommendations</div>

                <div style="margin-top: 550px; position: relative; z-index: 10; max-height: 400px; overflow-y: auto;">
                    <h3>Filtered Sessions</h3>
                    <table style="font-size: 0.85em;">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>City</th>
                                <th>Spot</th>
                                <th class="right">Farmers</th>
                                <th class="right">Acres</th>
                                <th class="right">Definite %</th>
                                <th class="right">Awareness %</th>
                                <th class="right">Clarity %</th>
                            </tr>
                        </thead>
                        <tbody id="tblSessions">
                            </tbody>
                    </table>
                </div>

                <button class="share-btn" style="position: absolute; bottom: 40px; right: 40px; padding: 10px 20px; background-color: var(--accent); border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                    Share Visual
                </button>
            </section>
        </main>
    </div>
</div>

<script src="data_processor.js"></script>
</body>
</html>
